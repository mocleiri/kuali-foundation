#!/bin/bash
#
# Output from this script gets logged to /var/log/cloud-init.log
#

#
# If you change this script it will not take affect on newly spun up EC2 instances until:
# 1 - You publish and release another version of kuali-ec2
# 2 - You update the top level kuali-pom so it contains a reference to the new version
# 3 - You publish and release another version of the kuali pom
# 4 - You make the kuali-example project point to the new version of the kuali pom
#
#
# If you only change what the following commands do behind the scenes,
# ie you add/update/remove plugin executions or alter the Ant scripting,
# no further action is required.  The changes will be automatically
# picked up and executed the next time an environment is spun up
#

set -xe
rm -rf /root/kuali-ec2
svn co https://svn.kuali.org/repos/foundation/trunk/kuali-ec2 /root/kuali-ec2
cd /root/kuali-ec2
MVN=/opt/asf/mvn/bin/mvn
$MVN clean install
$MVN clean process-resources -Ptomcat,${tomcat.version},medium -Djdk.version=${jdk.version}
$MVN clean process-resources -Pappdynamics
