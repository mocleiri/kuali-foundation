#!/bin/sh -x

USER=j2eemgr; typeset -rx USER
EXEC_TIME=`date +%Y%m%d.%H.%M.%S`; typeset -rx EXEC_TIME
BASE_DIRECTORY=/home/$USER/kuali; typeset -rx BASE_DIRECTORY
APPLICATION_DIRECTORY=$BASE_DIRECTORY/$APPLICATION; typeset -rx APPLICATION_DIRECTORY
LOGS_DIRECTORY=$APPLICATION_DIRECTORY/logs; typeset -rx LOGS_DIRECTORY
SCRIPT_NAME=`basename $0`; typeset -rx SCRIPT_NAME
SCRIPT_LOG=$LOGS_DIRECTORY/$SCRIPT_NAME+$EXEC_TIME.$$; typeset -rx SCRIPT_LOG

{
    DEPLOY_BASE_DIRECTORY=/opt/ears; typeset -rx DEPLOY_BASE_DIRECTORY
    DEPLOY_VERSION_FILE=version.properties; typeset -rx DEPLOY_VERSION_FILE
	UNDEPLOY_WAR_FILE_COMMAND=/usr/local/bin/j2ee_remove_war_file; typeset -rx UNDEPLOY_WAR_FILE_COMMAND
	UNDEPLOY_WAR_CONTEXT_COMMAND=/usr/local/bin/j2ee_remove_war_context; typeset -rx UNDEPLOY_WAR_CONTEXT_COMMAND
	UNDEPLOY_WAR_DIR_COMMAND=/usr/local/bin/j2ee_remove_war_dir; typeset -rx UNDEPLOY_WAR_DIR_COMMAND
	DEPLOY_WAR_COMMAND=/usr/local/bin/j2ee_deploy_war; typeset -rx DEPLOY_WAR_COMMAND
	DEPLOY_SETTINGS_COMMAND=/usr/local/bin/j2ee_deploy_settings; typeset -rx DEPLOY_SETTINGS_COMMAND
	DEPLOY_SECURITY_COMMAND=/usr/local/bin/j2ee_deploy_security; typeset -rx DEPLOY_SECURITY_COMMAND
    WORK_PURGE_COMMAND=/usr/local/bin/j2ee_deploy_work; typeset -rx WORK_PURGE_COMMAND
    ANT_COMMAND=/usr/local/ant/bin/ant; typeset -rx ANT_COMMAND
    ANT_BUILD_FILE=$BASE_DIRECTORY/build.xml; typeset -rx ANT_BUILD_FILE
    ANT_PROPERTIES_FILE=$APPLICATION_DIRECTORY/generated-build.properties; typeset -rx ANT_PROPERTIES_FILE
    DATABASE_PROJECT=kul-cfg-dbs; typeset -rx DATABASE_PROJECT
    IMPEX_PROPERTIES_FILE=$APPLICATION_DIRECTORY/impex-build.properties; typeset -rx IMPEX_PROPERTIES_FILE
    APPLICATION_INFRASTRUCTURE_JAVA_PROJECT=rice; typeset -rx APPLICATION_INFRASTRUCTURE_JAVA_PROJECT
    APPLICATION_INFRASTRUCTURE_SRCCTRL_VERSION=branches/$APPLICATION_INFRASTRUCTURE_JAVA_PROJECT-release-"`echo $APPLICATION_INFRASTRUCTURE_VERSION | sed 's/\./-/g'`"-br; typeset -rx APPLICATION_INFRASTRUCTURE_SRCCTRL_VERSION
	APPLICATION_INFRASTRUCTURE_DATABASE_PREFIX=ricekulcli; typeset -rx APPLICATION_INFRASTRUCTURE_DATABASE_PREFIX
	APPLICATION_INFRASTRUCTURE_DATABASE_VERSION="`echo $APPLICATION_INFRASTRUCTURE_VERSION | sed 's/\.//g'`"; typeset -rx APPLICATION_INFRASTRUCTURE_DATABASE_VERSION
    BUILD_NUMBER_FILE=$APPLICATION_DIRECTORY/build-number.txt; typeset -rx BUILD_NUMBER_FILE
	SRCCTRL_URL=https://test.kuali.org/svn; typeset -rx SRCCTRL_URL
    export JAVA_HOME=/usr/local/java

    cd $BASE_DIRECTORY
} >> $SCRIPT_LOG 2>&1