<?xml version="1.0"?>
<project name="JDK Manager">

  <target name="updatejdk7.1">
    <!-- ant -Dminor="40" updatejdk7 -->
    <property name="jdk.major.version" value="7" />
    <property name="jdk.minor.version" value="${minor}" />
    <property name="jdk.version" value="${jdk.major.version}.0.${jdk.minor.version}" />

    <property name="jdk.dir" value="${user.home}/.jdk/7" />
    <property name="kuali.dir" value="jdk${jdk.major.version}-1.${jdk.major.version}.0-u${jdk.minor.version}" />
    <property name="jdk.version.kuali.dir" value="${jdk.dir}/${kuali.dir}" />

    <property name="ora.dir" value="jdk1.${jdk.major.version}.0_${jdk.minor.version}" />
    <property name="jdk.version.ora.dir" value="${jdk.dir}/${ora.dir}" />


    <property name="jdk.kuali.zip.file" value= "jdk${jdk.major.version}-1-${jdk.major.version}.0-u${jdk.minor.version}-linux-x64.zip" />
    <property name="jdk.version.kuali.zip" value="${jdk.dir}/${jdk.kuali.zip.file}" />

    <property name="jdk.tar.file" value="jdk-${jdk.major.version}u${jdk.minor.version}-linux-x64.tar" />
    <property name="jdk.tar" value="${jdk.version.kuali.dir}/${jdk.tar.file}" />
    <property name="jdk.gz" value="${jdk.dir}/jdk-${jdk.major.version}u${jdk.minor.version}-linux-x64.tar.gz" />

    <echo message="${jdk.version}" />
    <echo message="${jdk.version.kuali.zip}" />

    <delete includeemptydirs="true" failonerror="false">
      <fileset dir="${jdk.version.kuali.dir}" />
      <fileset dir="${jdk.version.ora.dir}" />
      <fileset file="${jdk.version.kuali.zip}" />
    </delete>

    <mkdir dir="${jdk.version.kuali.dir}" />
    <gunzip src="${jdk.gz}" dest="${jdk.version.kuali.dir}"/>
     

    <zip destfile="${jdk.version.kuali.dir}/${jdk.kuali.zip.file}">
      <tarfileset src="${jdk.version.kuali.dir}/${jdk.tar.file}">
      <exclude name="*/src.zip"/>
      </tarfileset>
     </zip>

   <unzip src="${jdk.version.kuali.dir}/${jdk.kuali.zip.file}" dest="${jdk.version.kuali.dir}"/>

   <move todir="${jdk.version.kuali.dir}/${kuali.dir}">
    <fileset dir="${jdk.version.kuali.dir}/${ora.dir}">
    </fileset>
  </move>

     <delete includeemptydirs="true" failonerror="false">
      <fileset file="${jdk.version.kuali.dir}/${jdk.kuali.zip.file}" />
      <fileset file="${jdk.version.kuali.dir}/${jdk.tar.file}" />
    </delete>

   <zip destfile="${jdk.version.kuali.zip}" 
       basedir="${jdk.version.kuali.dir}" />

     <delete includeemptydirs="true" failonerror="false">
      <fileset dir="${jdk.version.kuali.dir}" />
    </delete>
  </target>


 <target name="updatejdk6">
    <property name="jdk.major.version" value="6" />
    <property name="jdk.minor.version" value="${minor}" />
    <property name="jdk.dir" value="${user.home}/.jdk/6" />
    <property name="jdk.version" value="${jdk.major.version}.0.${jdk.minor.version}" />
    <property name="jdk.bin.name" value="jdk-${jdk.major.version}u${jdk.minor.version}-linux-x64.bin" />
    <property name="jdk.bin.path" value="${jdk.dir}" />
    <property name="jdk.bin" value="${jdk.dir}/jdk-${jdk.major.version}u${jdk.minor.version}-linux-x64.bin" />
    <property name="jdk.zip" value="${jdk.dir}/jdk-${jdk.major.version}u${jdk.minor.version}-linux-x64.zip" />
    <property name="kuali.dir" value="jdk${jdk.major.version}-1.${jdk.major.version}.0-u${jdk.minor.version}" />
    <property name="ora.dir" value="jdk1.${jdk.major.version}.0_${jdk.minor.version}" />
    <property name="jdk.version.ora.dir" value="${jdk.dir}/jdk1.${jdk.major.version}.0_${jdk.minor.version}" />
    <property name="jdk.version.ora.dir.tmp" value="${jdk.dir}/jdk1.${jdk.major.version}.0_${jdk.minor.version}.tmp" />
    <property name="jdk.version.kuali.zip" value="${jdk.dir}/jdk${jdk.major.version}-1-${jdk.major.version}.0-u${jdk.minor.version}-linux-x64.zip" />
    <property name="jdk.kuali.zip.file"               value="jdk${jdk.major.version}-1-${jdk.major.version}.0-u${jdk.minor.version}-linux-x64.zip" />
    <property name="jdk.version.kuali.dir" value="${jdk.dir}/jdk${jdk.major.version}-1.${jdk.major.version}.0-u${jdk.minor.version}" />
    <echo message="${jdk.version}" />
    <echo message="${jdk.version.kuali.dir}" />
    <echo message="${jdk.version.ora.dir}" />
     
    <delete includeemptydirs="true" failonerror="false">
      <fileset dir="${jdk.version.kuali.ora}/${kuali.dir}"/>
      <fileset dir="${jdk.version.kuali.ora}"/>
      <fileset dir="${jdk.version.ora.dir}" />
      <fileset dir="${jdk.version.kuali.dir}" />
      <fileset dir="${jdk.version.kuali.zip}" />
      <fileset dir="${jdk.zip}" />
    </delete>
    <deltree dir="${jdk.version.ora.dir}"/>

    <exec dir="${jdk.bin.path}" executable="${jdk.bin.name}">
    </exec>

    <delete file="${jdk.version.ora.dir}/src.zip" />

    <symlink action="record" linkfilename="linked.record">
     <fileset dir="${jdk.version.ora.dir}" includes="**/**"/>
    </symlink>

    <!--Temporary Zip in order to move the basedir without errors -->
    <zip destfile="${jdk.version.kuali.zip}" basedir="${jdk.version.ora.dir}/" whenempty="create" /> 

    <!--Setup temporary directorys for the finale zip file-->
    <mkdir dir="${jdk.version.kuali.dir}"/>
    <mkdir dir="${jdk.version.kuali.dir}/${kuali.dir}"/>
    
    <!--Move the temporary zip file, which lacks a root directory with the proper name for kuali -->
    <move file="${jdk.version.kuali.zip}" todir="${jdk.version.kuali.dir}/${kuali.dir}"/>
   <unzip src="${jdk.version.kuali.dir}/${kuali.dir}/${jdk.kuali.zip.file}" dest="${jdk.version.kuali.dir}/${kuali.dir}/"/> 
    <!-- Get rid of the temporary zip file remaining -->
   <delete file="${jdk.version.kuali.dir}/${kuali.dir}/${jdk.kuali.zip.file}"/> 
    <!-- Create the zip file -->
   <zip destfile="${jdk.version.kuali.zip}" basedir="${jdk.version.kuali.dir}/" whenempty="create" /> 
   <symlink action="recreate" failonerror="no" overwrite="yes">
     <fileset dir="${jdk.version.kuali.dir}/${kuali.dir}" includes="*/dir.links"/>  
   </symlink>
    <delete includeemptydirs="true" failonerror="false">
      <fileset dir="${jdk.version.kuali.ora}/${kuali.dir}"/>
      <fileset dir="${jdk.version.kuali.dir}" />
      <fileset dir="${jdk.version.kuali.ora}"/>
      <fileset dir="${jdk.version.ora.dir}" />
      <fileset dir="${jdk.zip}" />
    </delete>
    <deltree dir="${jdk.version.ora.dir}"/>
   </target> 
</project>

