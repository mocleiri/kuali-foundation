function kantmod {
  {
    target=$1
    environment=$2
    klogmod "executing target: $target against environment: $environment"
    kexecmod "$ANT_COMMAND -Ddeployment.directory=$DEPLOY_BASE_DIRECTORY/$environment/$JAVA_APPLICATION_CODE -Dshared.external.build.properties=$ANT_PROPERTIES_FILE -f $ANT_BUILD_FILE $target" $target
    return 0
  } >> $SCRIPT_LOG 2>&1
}
typeset -xf kantmod

function klogmod {
  {
    typeset message=$1
    echo "`date +%Y%m%d.%H.%M.%S`: $message"
  } >> $SCRIPT_LOG 2>&1
}
typeset -xf klogmod

function kexecmod {
  {
    typeset command=$1
    typeset $target=$2
    klogmod "executing command: $command"
    eval $command
    typeset return_status=$?
    if [[ "$return_status" != "0" ]]
      then
        kendmod $return_status $target
    fi
    return $return_status
  } >> $SCRIPT_LOG 2>&1
}
typeset -xf kexecmod

function kendmod {
  {
    typeset exit_status=$1
    typeset target=$2
    klogmod "ending with exit status: $exit_status"
    if [[ "$exit_status" != "0" ]]
      then
      	if [[ "$target = "check-modularization" ]]
      		then kmailmod petienne@gmail.com "$SCRIPT_NAME has errors" "see $SCRIPT_LOG"
        kmailmod petienne@indiana.edu "$SCRIPT_NAME has errors" "see $SCRIPT_LOG"
    fi
    exit $exit_status
  } >> $SCRIPT_LOG 2>&1
}
typeset -xf kendmod

function kmailmod {
  {
    typeset recipient=$1
    typeset subject=$2
    typeset message=$3
    if [[ "$SEND_MAIL" = "true" ]]
      then
        klogmod "mailing recipent: $recipient"
        echo "$message" | mail -s "$subject" $recipient
    else
      echo "SEND_MAIL is turned off"
    fi 
  } >> $SCRIPT_LOG 2>&1
}
typeset -xf kmailmod

#  changes to make:
#  1) Modify script so that return status is not failure, this will allow the cvs task to complete successfully.
#  2) Change the output so that results are mailed to the developer's mailing list.

#  LIST OF VARIABLES:
# $ANT_COMMAND				=/usr/local/ant/bin/ant
# $DEPLOY_BASE_DIRECTORY		=/opt/ears
# $JAVA_APPLICATION_CODE		=kuali
# $ANT_PROPERTIES_FILE		=$APPLICATION_DIRECTORY/build.properties
# $ANT_BUILD_FILE				=$BASE_DIRECTORY/build.xml
# $SCRIPT_LOG					=$LOGS_DIRECTORY/$SCRIPT_NAME+$EXEC_TIME.$$
# $APPLICATION_CFG_MAIL_LIST	=kfcm-l@indiana.edu
# $SCRIPT_NAME				=`basename $0`

# APPLICATION_DIRECTORY		=$BASE_DIRECTORY/$APPLICATION
# BASE_DIRECTORY				=/home/$USER/kuali
# USER						=j2eemgr

# USER						=j2eemgr
# EXEC_TIME					=`date +%Y%m%d.%H.%M.%S`
# BASE_DIRECTORY				=/home/$USER/kuali
# APPLICATION_DIRECTORY		=$BASE_DIRECTORY/$APPLICATION
# LOGS_DIRECTORY				=$APPLICATION_DIRECTORY/logs
# SCRIPT_NAME					=`basename $0`
# SCRIPT_LOG					=$LOGS_DIRECTORY/$SCRIPT_NAME+$EXEC_TIME.$$

# APPLICATION=kfs